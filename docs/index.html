<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Security Configuration Platform Documentation</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Documentation for the Security Configuration Platform">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css">
  <style>
    .api-playground {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .api-playground pre {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
    }
    .api-playground .response {
      margin-top: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-left: 4px solid #007bff;
    }
    .mermaid {
      text-align: center;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <!-- Docsify v4 -->
  <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>

  <!-- Plugins -->
  <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-javascript.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-json.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-typescript.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-yaml.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify-copy-code"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify-tabs"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify-pagination/dist/docsify-pagination.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify-edit-on-github"></script>

  <!-- Mermaid.js -->
  <script src="//cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

  <!-- Swagger UI -->
  <script src="//cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>

  <!-- Custom API Playground -->
  <script>
    // API Playground Plugin
    function apiPlayground(hook, vm) {
      hook.beforeEach(function(content) {
        const apiPlaygroundRegex = /```api-playground\n([\s\S]*?)\n```/g;
        return content.replace(apiPlaygroundRegex, (match, content) => {
          const lines = content.split('\n');
          const endpoint = lines[0];
          const method = lines[1];
          const params = lines.slice(2).join('\n');

          return `
            <div class="api-playground">
              <h4>API Playground</h4>
              <p><strong>Endpoint:</strong> ${endpoint}</p>
              <p><strong>Method:</strong> ${method}</p>
              <pre><code class="language-json">${params}</code></pre>
              <button onclick="testEndpoint('${endpoint}', '${method}', ${JSON.stringify(params)})">Test API</button>
              <div class="response" id="api-response"></div>
            </div>
          `;
        });
      });
    }

    // Mermaid Plugin
    function mermaidPlugin(hook, vm) {
      hook.beforeEach(function(content) {
        const mermaidRegex = /```mermaid\n([\s\S]*?)\n```/g;
        return content.replace(mermaidRegex, (match, content) => {
          return `<div class="mermaid">${content}</div>`;
        });
      });

      hook.doneEach(function() {
        mermaid.initialize({
          startOnLoad: true,
          theme: 'default',
          securityLevel: 'loose'
        });
        mermaid.init(undefined, document.querySelectorAll('.mermaid'));
      });
    }

    // API Testing Function
    window.testEndpoint = async function(endpoint, method, params) {
      const responseDiv = document.getElementById('api-response');
      responseDiv.innerHTML = 'Testing...';

      try {
        const response = await fetch(endpoint, {
          method: method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${localStorage.getItem('token')}`
          },
          body: JSON.stringify(params)
        });

        const data = await response.json();
        responseDiv.innerHTML = `<pre><code class="language-json">${JSON.stringify(data, null, 2)}</code></pre>`;
      } catch (error) {
        responseDiv.innerHTML = `<pre><code class="language-json">${JSON.stringify({ error: error.message }, null, 2)}</code></pre>`;
      }
    };

    window.$docsify = {
      name: 'Security Configuration Platform',
      repo: 'robbedell/security-config-platform',
      loadSidebar: true,
      loadNavbar: true,
      subMaxLevel: 3,
      auto2top: true,
      plugins: [
        apiPlayground,
        mermaidPlugin
      ],
      search: {
        maxAge: 86400000,
        paths: 'auto',
        placeholder: 'Search',
        noData: 'No results found!',
        depth: 6
      },
      pagination: {
        previousText: 'Previous',
        nextText: 'Next',
        crossChapter: true,
        crossChapterText: true,
      },
      editOnGithub: {
        repo: 'robbedell/security-config-platform',
        branch: 'main',
        docsDir: 'docs',
        docsBranch: 'main'
      }
    }
  </script>
</body>
</html>
